= Rich Text
:toc: right
:imagesdir: media/
:sourcedir: ../src

In this chapter you'll learn how to render rich text content.

== Intro

Enonic boasts a rich text field field type aka https://developer.enonic.com/docs/xp/stable/cms/schemas/input-types/htmlarea[HtmlArea]. Unlike basic text fields, rich text may contain more complex concepts such as images, links and custom components (aka macros). Each of these will typically need to be processed during rendering in order to provide a contextually correct URL, ideal image sizes - not to mention rendering of custom components.


== Sample content

Luckily, our sample data set contains everyting we need to get going. The Bio field for persons is rich text, and some of the content is even populated with relevant content, like you see below:

image::rich-text-bio.png[title="Lea Seydoux with rich text bio content",width=672px]


== Task: Rich text rendering

Let's take `bio` input field from `Person` https://developer.enonic.com/docs/content-studio/stable/content-types[content type] and see how to render it.

. *Update the Person query*
+
To properly render Rich text, we need additional metadata about links and images.
+
To simplify things, Next.XP provides a `richTextQuery` helper function that generates the query for us. Also, this way we don't have to repeat the query for every rich text field.
+
*Add a new query* file to your project:
+
.src/components/queries/getPersonWithBio.ts
[source,Typescript]
----
include::{sourcedir}/components/queries/getPersonWithBio.ts[]
----
+
NOTE: The difference is this line: `${richTextQuery('bio')}``, and that getPerson must now be a function.
+
For further insight, visit the https://developer.enonic.com/docs/developer-101/stable/rich-text[rich text chapter] in the Developer 101 tutorial

. *The RichTextView component*
+
We also need an updated view component that will render the  `bio`.
+
NOTE:  It reads the `bio` data from the query response, and passes it to the `RichTextView` component.
+
.src/components/views/PersonWithBio.tsx
[source,tsx]
----
include::{sourcedir}/components/views/PersonWithBio.tsx[]
----
+
. *Update the mapping*
+
Finally, we need to update the mappings to use the new query and view.
+
Simply replace the `getPerson` query with `getPersonWithBio` and `Person` view with `PersonWithBio`. It should look something like this:
+
.src/components/_mappings.ts
[source,Typescript,linenums]
----
ComponentRegistry.addContentType(`${APP_NAME}:person`, {
    query: getPersonWithBio(),
    view: PersonWithBio
});
----
+
That's it!

The result should look something like this:
TODO Screenshot


== Macros

https://developer.enonic.com/docs/xp/stable/cms/macros[Macros] enable you to add custom components inside  your rich text. In order to render in your front-end, every macro need to be to registered as a component.


=== Filmography macro

In your Enonic project, a `filmography` macro has been pre-defined. You can find it in `src/main/resources/site/macros/filmography/filmography.xml`

If you have a closer look at the LÃ©a Seydoux content once more, you should see the following text snippet at the end of the bio text:

  [filmography heading="Lea's Movies"/]

This means, an editor has added the `filmography` macro, with a single `heading` parameter to the rich text.

=== Task: Render a macro

But there is no trace of it in the preview pane.
That is because we need to create a React component that will render it.

. *Add Filmography component*
+
This React component will automatically be invoked by the `RichTextView` component, if it encounters the filmography macro tag.
+
.src/components/macros/FilmographyMacro.tsx
[source,jsx]
----
include::{sourcedir}/components/macros/Filmography.tsx[]
----
+
. *Register macro*
+
In order for the `RichTextView` to be aware of your new macro, you must register it - just like any other component:
+
.src/components/_mappings.ts
[source,jsx]
----
...
import Filmography from './macros/Filmography';
...
ComponentRegistry.addMacro(`${APP_NAME}:filmography`, {
    view: Filmography,
    configQuery: '{ heading }'
});
----
+
NOTE: `configQuery` basically lets you ask for configuration values for your component, in this specific case the `heading`.
+
IMPORTANT: Macro must be registered before any component that uses it! Best practice is to register it at the top of the `_mappings.ts` file.
+
. *Congratulations!*
+
You should now be able to see macro render `Lea's Movies` within the rich text: http://localhost:3000/persons/lea-seydoux[http://localhost:3000/persons/lea-seydoux]!

In the next chapter we'll make it possible to <<pages#, create pages editorially>>.
